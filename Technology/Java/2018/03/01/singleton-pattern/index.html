<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>Singleton Pattern</title><meta name="description"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="1. Singleton Pattern là gì?

The Singleton Pattern ensure a class only has one instance, and provide a global point of access to it
Nghĩa là: Với 1 class, Singleton đảm bảo luôn luôn có 1 và chỉ 1 instance được khởi tạo cho class đó. Và có thể truy cập
instance đó ở bất kỳ đâu (bằng cách gọi class method).

2. Ưu, nhược điểm
a. Ưu điểm

Đảm bảo lass chỉ có.."><meta name="generator" content="Hexo 5.4.0"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Michael Bell's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Singleton Pattern</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Singleton-Pattern-la-gi"><span class="toc-text">1. Singleton Pattern là gì?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Uu-nhuoc-diem"><span class="toc-text">2. Ưu, nhược điểm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-Uu-diem"><span class="toc-text">a. Ưu điểm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-Nhuoc-diem"><span class="toc-text">b. Nhược điểm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-Khi-nao-ap-dung"><span class="toc-text">c. Khi nào áp dụng</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Implementation"><span class="toc-text">3. Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-Lazy-initialization"><span class="toc-text">a. Lazy initialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-Thread-Safe-initialization"><span class="toc-text">b. Thread Safe initialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-Double-checked-locking"><span class="toc-text">c. Double checked locking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d-Eager-initialization"><span class="toc-text">d. Eager initialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e-Bill-Pugh-Singleton-Implementation"><span class="toc-text">e. Bill Pugh Singleton Implementation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Refer"><span class="toc-text">4. Refer</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Technology"><i class="tag post-item-tag">Technology</i></a><a href="/tags/Java"><i class="tag post-item-tag">Java</i></a><a href="/tags/SingletonPattern"><i class="tag post-item-tag">SingletonPattern</i></a><a href="/tags/DesignPattern"><i class="tag post-item-tag">DesignPattern</i></a><a href="/tags/CreationalPatterns"><i class="tag post-item-tag">CreationalPatterns</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Singleton Pattern</h1><time class="has-text-grey" datetime="2018-03-01T15:37:47.000Z">2018-03-01</time><article class="mt-2 post-content"><h2 id="1-Singleton-Pattern-la-gi">1. Singleton Pattern là gì?</h2>
<blockquote>
<p><strong>The Singleton Pattern ensure a class only has one instance, and provide a global point of access to it</strong></p>
<p>Nghĩa là: Với 1 class, Singleton đảm bảo luôn luôn có 1 và chỉ 1 instance được khởi tạo cho class đó. Và có thể truy cập
instance đó ở bất kỳ đâu (bằng cách gọi class method).</p>
</blockquote>
<h2 id="2-Uu-nhuoc-diem">2. Ưu, nhược điểm</h2>
<h3 id="a-Uu-diem">a. Ưu điểm</h3>
<ul>
<li>Đảm bảo lass chỉ có duy nhất 1 instance</li>
<li>Có một global access point trong instance duy nhất đó.</li>
<li>Singleton object được khởi tạo chỉ khi call class method lần đầu tiên</li>
</ul>
<h3 id="b-Nhuoc-diem">b. Nhược điểm</h3>
<ul>
<li>Vi phạm nguyên tắc <strong>Single Responsibility Principle</strong> do vừa phải chịu trách nhiệm cho việc quản lý instance của chính nó và vừa quản lý các business logic trong program.</li>
<li>Cần handle với multithreading.</li>
<li>Khó trong việc unit test</li>
</ul>
<h3 id="c-Khi-nao-ap-dung">c. Khi nào áp dụng</h3>
<ul>
<li>Khi class chỉ cần có 1 instance cho tất cả clients. VD: Database Connection, Logger, Caching…</li>
</ul>
<h2 id="3-Implementation">3. Implementation</h2>
<p><img src="/images/design-pattern/singleton.png" alt="singleton"></p>
<h3 id="a-Lazy-initialization">a. Lazy initialization</h3>
<ul>
<li>Chỉ work well nếu Single thread</li>
</ul>
<blockquote>
<pre><code> public class Database &#123;
 
     private static Database instance;
 
     // để constructor là private để tránh việc khởi tạo Object từ bên ngoài
     private Database()&#123;&#125;
 
     // cần phải là static method để có thể gọi được getInstance() từ bên ngoài.
     // vì không thể gọi được method bình thường nếu không khởi tạo được instance.
     public static Database getInstance() &#123;
         if (instance == null) instance = new Database();
         return instance;
     &#125;
 &#125;
</code></pre>
</blockquote>
<h3 id="b-Thread-Safe-initialization">b. Thread Safe initialization</h3>
<ul>
<li>Bằng các synchronized cả class method dễ dàng cung cấp thread-safety</li>
<li>Tuy nhiên việc synchronized cả method rất tốn kém mà thực tế chúng ta chỉ cần thread safe với lần tạo instance đầu tiên. Còn khi
instance đã được khởi tạo thì không cần đến thread safe nữa. Để tránh việc này có thể áp dụng Double checked locking bên dưới</li>
</ul>
<blockquote>
<pre><code>  public class Database &#123;
  
      private static Database instance;
  
      private Database()&#123;&#125;
  
      // synchronized để thread safe
      public synchronized static Database getInstance() &#123;
          if (instance == null) instance = new Database();
          return instance;
      &#125;
  &#125;
</code></pre>
</blockquote>
<h3 id="c-Double-checked-locking">c. Double checked locking</h3>
<ul>
<li>Chuyển việc synchronized method sang block synchronized và dùng
<a href="/Technology/Java/Scala/2020/12/12/java-memory-model/#3-Bo-nho-phan-cung-tuong-tac-voi-JVM-memory">volatile</a> keyword.</li>
<li>Việc khai báo <strong>DatabaseSyncDoubleCheck result = instance</strong> sẽ giúp performance của method tăng lên 25%. Vì nó giúp hạn chế việc access đến biến volatile.</li>
</ul>
<blockquote>
<pre><code>  public class Database &#123;
  
      private volatile static Database instance; 

      private Database()&#123;&#125;
  
  public static DatabaseSyncDoubleCheck getInstance() &#123; 
          DatabaseSyncDoubleCheck result = instance;
          if (result == null) &#123;
              // chỉ synchronize trong lần khởi tạo đầu tiên
              synchronized (DatabaseSyncDoubleCheck.class) &#123;
                  result = instance;
                  if (instance == null) &#123;
                      instance = result = new DatabaseSyncDoubleCheck();
                  &#125;
              &#125;
          &#125;
          return result;
      &#125;
  &#125;
</code></pre>
</blockquote>
<h3 id="d-Eager-initialization">d. Eager initialization</h3>
<ul>
<li>Thay vì khởi tạo instance khi getInstance() được call thì ta sẽ tạo new instance khi ngay khi class được load.</li>
<li>Cách implement này phù hợp với singleton class không sử dụng nhiều resources.</li>
</ul>
<blockquote>
<pre><code>  public class DatabaseEager &#123;
      
      // vì là một static variable nên instance sẽ được khởi tạo khi load class
      // nó sẽ đảm bảo thread safe
      private static final DatabaseEager instance = new DatabaseEager();
  
      private DatabaseEager()&#123;&#125;
  
      public static DatabaseEager getInstance() &#123;
          return instance;
      &#125;
  &#125;
</code></pre>
</blockquote>
<h3 id="e-Bill-Pugh-Singleton-Implementation">e. Bill Pugh Singleton Implementation</h3>
<ul>
<li>Khi <strong>BillPughSingleton</strong> được load thì <strong>SingletonHelper</strong> sẽ không được load và memory. Chỉ khi nào getInstance() được gọi thì lớp Helper mới
được gọi và tạo ra instance cho Singleton class.</li>
<li>Các tiếp cận này không cần synchronization. Vì instance chỉ được khởi tạo 1 lần duy nhất để lưu vào biến static final.</li>
<li>Đây là một cách implement đơn giản nhưng rất hiệu quả.</li>
</ul>
<blockquote>
<pre><code>  public class BillPughSingleton &#123;
  
      private BillPughSingleton()&#123;&#125;
  
      private static class SingletonHelper&#123;
          private static final BillPughSingleton INSTANCE = new BillPughSingleton();
      &#125;
  
      public static BillPughSingleton getInstance()&#123;
          return SingletonHelper.INSTANCE;
      &#125;
  &#125;
</code></pre>
</blockquote>
<h2 id="4-Refer">4. Refer</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/thread-safety-in-java-singleton-classes">https://www.digitalocean.com/community/tutorials/thread-safety-in-java-singleton-classes</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/michaelbell1008/Tutorial/tree/master/src/main/java/tutorial/designpattern/creational/singleton">Code example</a></li>
</ul>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/Technology/JS/2018/05/12/cookies/" title="Cookies"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: Cookies</span></a><a class="button is-default" href="/Technology/Java/2018/01/25/strategy-pattern/" title="Strate Pattern"><span class="has-text-weight-semibold">Next: Strate Pattern</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/michaelbell1008"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><a title="linkedin" target="_blank" rel="noopener nofollow" href="//www.linkedin.com/in//nguyen-chuong-2768a5124/"><i class="iconfont icon-linkedin"></i></a><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//ChuongNguyen1008"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Michael Bell 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p class="is-flex is-justify-content-center"></p><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>